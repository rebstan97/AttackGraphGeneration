from urllib.request import Request, urlopen
from bs4 import BeautifulSoup

class VulnerabilityNode(object):
    def __init__(self, CVEName, port):
        self.vulnerabilityName = CVEName
        self.vulnerabilityPort = port
        self.mapping1 = { 'High': 2, 'Low': 1, 'None': 0 }
        self.mapping2 = { 'Admin': 2, 'User': 1, 'None': 0 }
        self.accessLevel = self.mapping2[self.get_gained_access()]
        self.requiredPrivilege = self.mapping1[self.get_required_privilege()]

    def get_gained_access(self):
        url = "https://www.cvedetails.com/cve/" + self.vulnerabilityName
        req = Request(url, headers={'User-Agent': 'Mozilla/5.0'})
        html_doc = urlopen(req).read()
        soup = BeautifulSoup(html_doc, 'lxml')
        table = soup.find("table", { 'id': 'cvssscorestable', 'class': 'details'})
        field_row = table.findAll("tr")[6]
        field_value = field_row.find("span").string
        return field_value
    
    def get_required_privilege(self):
        url = "https://nvd.nist.gov/vuln/detail/" + self.vulnerabilityName
        html_doc = urlopen(url)
        soup = BeautifulSoup(html_doc, 'lxml')
        tag = soup.find('span', { 'data-testid': 'vuln-cvssv3-pr' })
        if tag:
            field_value = tag.string.strip()
        else:
            field_value = "None" # By default, "None" privileges are required
        return field_value

# Test
# vuln = VulnerabilityNode("CVE-2019-13341")
# print(vuln.accessLevel)
# print(vuln.requiredPrivilege)